---
description: Visual process map for ARCHIVE mode (Task Documentation)
globs: "**/archive*/**", "**/document*/**", "**/complete*/**"
alwaysApply: false
---

# ARCHIVE MODE: TASK DOCUMENTATION PROCESS MAP

> **TL;DR:** This visual map guides the ARCHIVE mode process, focusing on creating comprehensive documentation of the completed task, archiving relevant files, and updating the Memory Bank for future reference.

## üß≠ ARCHIVE MODE PROCESS FLOW

```mermaid
graph TD
    Start["START ARCHIVE MODE"] --> ReadTasks["Read tasks.md<br>reflection.md and<br>progress.md"]
    
    %% Initial Assessment
    ReadTasks --> VerifyReflect{"Reflection<br>Complete?"}
    VerifyReflect -->|"No"| ReturnReflect["Return to<br>REFLECT Mode"]
    VerifyReflect -->|"Yes"| AssessLevel{"Determine<br>Complexity Level"}
    
    %% Level-Based Archiving
    AssessLevel -->|"Level 1"| L1Archive["LEVEL 1 ARCHIVING"]
    AssessLevel -->|"Level 2"| L2Archive["LEVEL 2 ARCHIVING<br>Level2/archive-basic.mdc"]
    AssessLevel -->|"Level 3"| L3Archive["LEVEL 3 ARCHIVING<br>Level3/archive-intermediate.mdc"]
    AssessLevel -->|"Level 4"| L4Archive["LEVEL 4 ARCHIVING<br>Level4/archive-comprehensive.mdc"]
    
    %% Level 1 Archiving (Minimal)
    L1Archive --> L1Summary["Create Quick<br>Summary"]
    L1Summary --> L1Task["Update<br>tasks.md"]
    L1Task --> L1Complete["Mark Task<br>Complete"]
    
    %% Level 2 Archiving (Basic)
    L2Archive --> L2Summary["Create Basic<br>Archive Document"]
    L2Summary --> L2Doc["Document<br>Changes"]
    L2Doc --> L2Task["Update<br>tasks.md"]
    L2Task --> L2Progress["Update<br>progress.md"]
    L2Progress --> L2Complete["Mark Task<br>Complete"]
    
    %% Level 3-4 Archiving (Comprehensive)
    L3Archive & L4Archive --> L34Summary["Create Comprehensive<br>Archive Document"]
    L34Summary --> L34Doc["Document<br>Implementation"]
    L34Doc --> L34Creative["Archive Creative<br>Phase Documents"]
    L34Creative --> L34Code["Document Code<br>Changes"]
    L34Code --> L34Test["Document<br>Testing"]
    L34Test --> L34Lessons["Summarize<br>Lessons Learned"]
    L34Lessons --> L34Task["Update<br>tasks.md"]
    L34Task --> L34Progress["Update<br>progress.md"]
    L34Progress --> L34System["Update System<br>Documentation"]
    L34System --> L34Complete["Mark Task<br>Complete"]
    
    %% Completion - Archive, Clear, and Commit
    L1Complete & L2Complete & L34Complete --> CreateArchive["Create Archive<br>Document in<br>memory-bank/archive/<kind>/"]
    CreateArchive --> ClearFiles["Clear Task-Specific<br>Files (creative/, reflection/,<br>tasks.md, progress.md,<br>activeContext.md, .qa_validation_status)"]
    ClearFiles --> GitCommit["Git Commit<br>chore: archive task-id<br>and clear memory bank"]
    GitCommit --> Ready["Memory Bank Ready<br>for Next Task"]
    
    style GitCommit fill:#81c784,stroke:#4caf50,color:#fff
    style Ready fill:#b0bec5,stroke:#90a4ae
```

## üìã ARCHIVE DOCUMENT STRUCTURE

The archive document should follow this structured format:

```mermaid
graph TD
    subgraph "Archive Document Structure"
        Header["# TASK ARCHIVE: [Task Name]"]
        Meta["## METADATA<br>Task info, dates, complexity"]
        Summary["## SUMMARY<br>Brief overview of the task"]
        Requirements["## REQUIREMENTS<br>What the task needed to accomplish"]
        Implementation["## IMPLEMENTATION<br>How the task was implemented"]
        Testing["## TESTING<br>How the solution was verified"]
        Lessons["## LESSONS LEARNED<br>Key takeaways from the task"]
        Refs["## REFERENCES<br>Links to related documents"]
    end
    
    Header --> Meta --> Summary --> Requirements --> Implementation --> Testing --> Lessons --> Refs
```

## üìä REQUIRED FILE STATE VERIFICATION

Before archiving can begin, verify file state:

```mermaid
graph TD
    Start["File State<br>Verification"] --> CheckTasks{"tasks.md has<br>reflection<br>complete?"}
    
    CheckTasks -->|"No"| ErrorReflect["ERROR:<br>Return to REFLECT Mode"]
    CheckTasks -->|"Yes"| CheckReflection{"reflection.md<br>exists?"}
    
    CheckReflection -->|"No"| ErrorCreate["ERROR:<br>Create reflection.md first"]
    CheckReflection -->|"Yes"| CheckProgress{"progress.md<br>updated?"}
    
    CheckProgress -->|"No"| ErrorProgress["ERROR:<br>Update progress.md first"]
    CheckProgress -->|"Yes"| ReadyArchive["Ready for<br>Archiving"]
```

## üîç ARCHIVE TYPES BY COMPLEXITY

```mermaid
graph TD
    subgraph "Level 1: Minimal Archive"
        L1A["Basic Bug<br>Description"]
        L1B["Solution<br>Summary"]
        L1C["Affected<br>Files"]
    end
    
    subgraph "Level 2: Basic Archive"
        L2A["Enhancement<br>Description"]
        L2B["Implementation<br>Summary"]
        L2C["Testing<br>Results"]
        L2D["Lessons<br>Learned"]
    end
    
    subgraph "Level 3-4: Comprehensive Archive"
        L3A["Detailed<br>Requirements"]
        L3B["Architecture/<br>Design Decisions"]
        L3C["Implementation<br>Details"]
        L3D["Testing<br>Strategy"]
        L3E["Performance<br>Considerations"]
        L3F["Future<br>Enhancements"]
        L3G["Cross-References<br>to Other Systems"]
    end
    
    L1A --> L1B --> L1C
    
    L2A --> L2B --> L2C --> L2D
    
    L3A --> L3B --> L3C --> L3D --> L3E --> L3F --> L3G
```

## üìù ARCHIVE DOCUMENT TEMPLATES

### Level 1 (Minimal) Archive
```
# Bug Fix Archive: [Bug Name]

## Date
[Date of fix]

## Summary
[Brief description of the bug and solution]

## Implementation
[Description of the fix implemented]

## Files Changed
- [File 1]
- [File 2]
```

### Levels 2-4 (Comprehensive) Archive
```
# Task Archive: [Task Name]

## Metadata
- **Complexity**: Level [2/3/4]
- **Type**: [Enhancement/Feature/System]
- **Date Completed**: [Date]
- **Related Tasks**: [Related task references]

## Summary
[Comprehensive summary of the task]

## Requirements
- [Requirement 1]
- [Requirement 2]
- [Requirement 3]

## Implementation
### Approach
[Description of implementation approach]

### Key Components
- [Component 1]: [Description]
- [Component 2]: [Description]

### Files Changed
- [File 1]: [Description of changes]
- [File 2]: [Description of changes]

## Testing
- [Test 1]: [Result]
- [Test 2]: [Result]

## Lessons Learned
- [Lesson 1]
- [Lesson 2]
- [Lesson 3]

## Future Considerations
- [Future enhancement 1]
- [Future enhancement 2]

## References (Optional - omit if none)
- [Link to external issue/ticket that prompted this work]
- [Link to external specs or documentation]
- [Link to related PR in another repository]

> **NOTE:** This section is OPTIONAL. Omit it entirely if there are no useful external references.
> Do NOT include: placeholders, vague descriptions, or links to ephemeral memory-bank files.
> The archive is in git; commits are discoverable via `git log`.
```

## üìã ARCHIVE LOCATION AND NAMING

Archive documents should be organized following this pattern:

**CRITICAL:** All archive documents must be created in `memory-bank/archive/<kind>/<YYYYMMDD>-<task-id>.md` format.

```mermaid
graph TD
    subgraph "Archive Structure"
        Root["memory-bank/archive/"]
        BugFixes["bug-fixes/"]
        Enhancements["enhancements/"]
        Features["features/"]
        Systems["systems/"]
        Documentation["documentation/"]
        
        Root --> BugFixes
        Root --> Enhancements
        Root --> Features
        Root --> Systems
        Root --> Documentation
        
        BugFixes --> Bug["YYYYMMDD-task-id.md"]
        Enhancements --> Enhancement["YYYYMMDD-task-id.md"]
        Features --> Feature["YYYYMMDD-task-id.md"]
        Systems --> System["YYYYMMDD-task-id.md"]
        Documentation --> Doc["YYYYMMDD-task-id.md"]
    end
```

### Archive Kind Categories

- **bug-fixes/**: Bug fixes and quick fixes (Level 1-2)
- **enhancements/**: Simple enhancements and improvements (Level 2)
- **features/**: New features and functionality (Level 3)
- **systems/**: Complex system changes and architecture (Level 4)
- **documentation/**: Documentation updates and improvements

### Naming Format

Format: `memory-bank/archive/<kind>/<YYYYMMDD>-<task-id>.md`

Examples:
- `memory-bank/archive/bug-fixes/20251213-ruleset-bug-fixes.md`
- `memory-bank/archive/enhancements/20251213-archive-clear-docs.md`
- `memory-bank/archive/features/20251215-user-authentication.md`
- `memory-bank/archive/systems/20251220-api-redesign.md`
- `memory-bank/archive/documentation/20251213-archive-clear-docs.md`

## üìä TASKS.MD FINAL UPDATE

When archiving is complete, update tasks.md with:

```
## Status
- [x] Initialization complete
- [x] Planning complete
[For Level 3-4:]
- [x] Creative phases complete
- [x] Implementation complete
- [x] Reflection complete
- [x] Archiving complete

## Archive
- **Date**: [Completion date]
- **Archive Document**: [Link to archive document]
- **Status**: COMPLETED
```

## üìã ARCHIVE VERIFICATION CHECKLIST

```
‚úì ARCHIVE VERIFICATION
- Reflection document reviewed? [YES/NO]
- Archive document created with all sections? [YES/NO]
- Archive document placed in correct location? [YES/NO]
- Creative phase documents inlined in archive (Level 3-4)? [YES/NO/NA]

‚úì CLEANUP VERIFICATION
- creative/ directory cleared? [YES/NO]
- reflection/ directory cleared? [YES/NO]
- tasks.md cleared (reset to initial state)? [YES/NO]
- progress.md cleared (reset to initial state)? [YES/NO]
- activeContext.md cleared (reset to initial state)? [YES/NO]
- .qa_validation_status removed? [YES/NO]
- Repository-specific files preserved? [YES/NO]

‚úì GIT COMMIT VERIFICATION
- All changes committed to git? [YES/NO]
- Commit message: "chore: archive <task-id> and clear memory bank"? [YES/NO]

‚Üí If all YES: Archiving complete - Memory Bank ready for next task
‚Üí If any NO: Complete missing steps before proceeding
```

## üîÑ TASK COMPLETION NOTIFICATION

When archiving is complete, notify user with:

```
## TASK ARCHIVED

‚úÖ Archive document created in memory-bank/archive/<kind>/
‚úÖ Task-specific files cleared (creative/, reflection/, tasks.md, progress.md, activeContext.md, .qa_validation_status)
‚úÖ Repository knowledge preserved
‚úÖ Git commit: "chore: archive <task-id> and clear memory bank"

‚Üí Memory Bank is ready for the next task
‚Üí To start a new task, use /niko
```

## üßπ Automatic Memory Bank Cleanup (Built into /archive)

The `/archive` command automatically clears task-specific files after creating the archive document. There is no separate `/archive clear` command.

### Files Cleared vs Preserved

```mermaid
graph TD
    subgraph "Files CLEARED (Task-Specific)"
        ClearCreative["creative/<br>directory"]
        ClearReflection["reflection/<br>directory"]
        ClearTasks["tasks.md"]
        ClearProgress["progress.md"]
        ClearActive["activeContext.md"]
        ClearQA[".qa_validation_status"]
    end
    
    subgraph "Files PRESERVED (Repository-Specific)"
        KeepProject["projectbrief.md"]
        KeepProduct["productContext.md"]
        KeepSystem["systemPatterns.md"]
        KeepTech["techContext.md"]
        KeepStyle["style-guide.md"]
        KeepArchive["archive/<br>directory"]
    end
    
    ClearCreative & ClearReflection & ClearTasks & ClearProgress & ClearActive & ClearQA --> Cleared["CLEARED"]
    KeepProject & KeepProduct & KeepSystem & KeepTech & KeepStyle & KeepArchive --> Preserved["PRESERVED"]
    
    style Cleared fill:#ef5350,stroke:#c62828,color:#fff
    style Preserved fill:#66bb6a,stroke:#388e3c,color:#fff
```

### Git Commit (REQUIRED)

The `/archive` command always ends with a git commit:

```
‚úì Git Commit
- Archive document created
- Task-specific files cleared
- All changes staged and committed
- Commit message: "chore: archive <task-id> and clear memory bank"
- Operation is revertable via: git revert HEAD
``` 
